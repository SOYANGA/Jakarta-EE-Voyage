# Spring Aop演变

**重点**

> 1. 理解AOP概念
> 2. 了解AOP的基础知识’
> 3. 掌握AOP的基础编程
> 4. 了解基于@AspectJ和Schema的AOP

## 1.AOP是什么？

### 1.1AOP的概念

AOP`Aspect oriented Programing`简称，面向切面编程。可以说是OOP（`Object-Oriented Programing`面向对象编程）的补充和完善。OOP三大特征：**封装、继承、多态**等概念来建立一种**对象层结构**，**用以模拟公共行为的一个集合**。当我们需要**分散的对象引入公共行为的时候**，OOP则显得无能为力。也就是说，**OOP允许你定义从上到下的关系，但并不适合定义从左到右的关系**。

例如日志功能，日志代码往往水平的散步在所有对象层次中，而与它所散步到的对象的核心功能毫无关系。对于其他类型的代码，如安全性，异常处理也是如此。**这种散步在各处的代码被称为横切（cross-cutting）代码，在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。** 

而AOP技术则恰恰相反，它利用一种称为“横切”的技术，解剖开封装的对象内部，并将那些影响了多个类的**公共行为封装到一个可重用模块**，并将其命名为“Aspect”切面

所谓”切面“，**就是将那些与业务无关，却为业务模块所共同调用或责任封装起来，==便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和维护性。==**AOP代表的是一个横向的关系。

> 如果说“对象”是一个空心圆柱体，其中封装的是对象得到属性和行为；那么面向切面编程就是一把利刃，将这些空心圆柱剖开，以获得其内部的消息。而剖开的切面，也就是所谓的“切面”了，然后它又以巧夺天功的妙手将这些切面复原，不留痕迹。

![1555488483358](D:\婕\JavaEE学习之路\Spring\picture\AOP与OOP关注点的区别)

AOP把软件系统分为两部分：**核心关注点**和**横切关注点**。 

两点之间并没有紧密的耦合  解耦**功能逻辑**和**对象核心业务**

**核心关注点：**业务处理的主要流程就是核心关注点

**横切关注点**：与之关系不大的部分且每层业务都会涉及到的公共部分被称为横切关注点。(并不是所属对象所作的事)

**横切关注点的特点：**横切关注点有一个特点，他们经常发生在核心关注点的多处，而各处都基本相似。比如权限认证，日志，事务处理。

**AOP的作用**：AOP的作用在于**分离系统中的各个关注点，将核心关注点和横切关注点分离开来。**

**AOP的核心思想**就是“**将应用程序中的商业逻辑同对其提供支持的通用服务进行分离**。”-----拆分核心关注点 与 横切关注点（通用辅助共同点）

![1555489002470](D:\婕\JavaEE学习之路\Spring\picture\OOP作用)

实现AOP技术，主要分为两大类

- 采用**动态代理技术**，利用**截取消息**的方式，对该**消息进行装饰**，以**取代原有对象行为的执行**。
- 采用**静态植入的方式**，引入特定的语法创建“切面“”，从而使得编译器可以在**编译期间植入有关“切面”的代码。** 

## 2.AOP思想演变

### 2.1演变过程

一个接口由多个类实现，且类中均有核心的业务方法和一些公共处理（安全检查，权限检查，打印日志等公共模块）

则在每个类的核心业务实现的时候就会大量重复编写这块的代码，所以我们将公共部分提取出模板或者公共的父类方法。然后让调用的类来使用公共模板或者继承公共父类。

- 弊端

但是这种方式有弊端就是，当业务扩展时，或需求更改时我们必须要修改大量的代码。需要修改的地方分散在很多个文件中，如果需要修改的文件很多那么修改的量会很大，这无疑会增加出错的几率，并且加大系统维护的难度。 而且，如果添加功能的需求是在软件开发的后期才提出的话，这样大量修改已有的文件，也不符合基本的“**开-闭原则”。**

改进解决方案

采用装饰器模式或者代理模式来实现业务公共业务和核心业务直间的关系

- 装饰器模式定义：动态地给一个对象添加一些额外地指责。就是增加功能来说，装饰器模式比生成子类更为灵活。
- 代理模式定义：为其它对象提供一种代理以控制这个对象的访问。（将对象访问限制为经过代理对象后才能访问到）

代理分为：

- 静态代理（实现同一个接口）/JDK动态代理
- CGLIB动态代理

相比于JDK动态代理（实现InvocationHandler 接口 覆写invoke方法）来说CGIB更灵活，JDK动态代理只能解决存在接口的子类的代理。而CGLIB则无序有接口，只需要有对象即可实现动态代理（继承MethodInterceptor 类实现intercept方法）生成一个拦截器，即包装原有方法。进而达到实现动态代理的作用。

但是这样做确实解决了公共模块代码冗余的情况，但是这样一来所有使用到公共模块的对象，都不能直接生成，需要经过动态代理后才能使用，并不符合面向对象编程的习惯。

![1555519359986](D:\婕\JavaEE学习之路\Spring\picture\AOP演变过程-动态代理)

为了更好的解决--AOP提供

人们认识到，传统的程序经常表现出一些不能自然地适合跨越多个程序模块的行为，例如日志记录、对上下文敏感 的错误处理等等，人们将这种行为称为 **“横切关注点（Cross Cutting Concern）**”，因为它跨越了给定编程模型中 的典型职责界限。 如果使用过于密切关注点的代码，就会知道**缺乏模块性**所带来的问题。因为横切行为的实现是分散的，开发人员发现**这种行为难以作逻辑思维实现和更改**。因此，面向方面的编程AOP应运而生。 

## 2.AOP作用?

切面关注通用的逻辑，下面是在项目中常用到切面的场景：